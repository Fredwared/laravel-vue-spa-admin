# Laravel-SPA-Admin 应用的生命周期

## 更新日志

-   更新时间： 2017-09-17  - 更新人员： 胡中园

## 单页面的基本概念和其生命周期

单页面应用的生命周期和传统的多页面应用的生命周期有一些差异

单页面应用的生命周期如下：

1.  用户在浏览器中输入应用地址的首页并回车。

    此时服务端返回一个 content-type 为 html 的页面。

    响应的头部包含 SessionCookie ，

    页面的 body 部分由两部分组成：一个空的 div ，以及一个 app.js 文件

2.  app.js 中包含以下几个核心的模块：

    -   组件模块
        -   组件上可以定义一段 html 片段。这个 html 片段一般会被渲染到页面中的某个区域。组件中还可以嵌套其他的组件。可以把上面的 空 div 理解为所有组件的根组件。
        -   组件上可以承载一些数据，这些数据一般会作为该组件的 html 片段中所展示的内容。如一个 用户表格组件，该组件的 html 片段是一个 `<table></table>` ， 而该组件上的数据则是表格中每个单元格所需的内容
        -   组件上可以承载一些方法，这些方法可以修改自身承载的数据。数据被修改之后，组件对应的 html 片段中展示的内容也会自动地被修改，组件的方法一般会通过 ajax 请求来获取/更新数据， 我们编写的大多数 js 代码大部分都是在为各种组件增加各种不同的方法
    -   路由模块
        -   路由模块中包含一个配置，该配置定义了浏览器中展示的地址与页面中展示的组件的对应关系。当浏览器中展示的地址发生变化时，页面中被展示的组件也会自动发生变化。
        -   路由模块对外提供一些接口，组件可以通过调用路由模块提供的接口来修改浏览器当前展示的地址。当地址变化后，路由模块会根据其配置，自动地移除不再需要展示的组件，自动地加载和渲染新的组件。**从效果上来看，就像是页面被刷新了一样，但是请注意：此时浏览器并没有向服务器请求一个新的页面。**
    -   状态管理模块
    -   事件管理模块

3.  路由模块检测到当前的浏览器地址是应用的首页，此时路由模块将首页所需的组件（如顶部菜单栏组件，左侧菜单树组件，右侧操作区组件等）引入并渲染到页面中

4.  用户点击了左侧菜单树中的某个菜单项，此时，该菜单项所属的左侧菜单树组件会调用路由模块的接口，将浏览器的地址栏中展示的网址修改为该菜单项配置的新网址，网址修改后，路由模块会自动地销毁不再需要展示的组件,加载新的组件,看起来就像是页面'刷新'了一样

5.  从 4 中可以看到，通过路由模块来修改网址时，浏览器并不会向服务器请求一个新的页面。只有当用户手动按 F5 来刷新页面时，才会重新向服务器发起 html 类型的请求。

6.  当用户手动按 F5 来刷新页面时，不管刷新的页面的路径是什么，服务器统一返回一个相同的 html .该 html 的 body 部分由两部分组成：一个空的 div ，以及一个 app.js 文件。实际上，这个页面和步骤1 中的页面完全相同。

7.  路由模块检测到当前的浏览器地址是角色列表页(举例),此时路由模块将角色列表页所需的组件（如顶部菜单栏组件，左侧菜单树组件，右侧角色列表组件等）引入并渲染到页面中. 实际上, 步骤 6-7 和步骤 1-3 是完全相同的逻辑.

8.  步骤 1-7 之间的循环构成了我们的单页应用的生命周期